<!--
種別: decisions
対象: ログ・記録方式
作成日: 2026-02-26
更新日: 2026-02-26
担当: AIエージェント
-->

# ログ・記録方式

## 概要

finger-tracker のアプリケーションログと計測結果の記録方式を決定する。

## 設計判断

### 判断1: ロギングライブラリ — Python 標準 logging

**問題**: アプリケーションログをどのライブラリで出力するか

**選択肢**:

1. Python 標準 logging
2. print のみ
3. loguru（サードパーティ）

**決定**: 選択肢1 — Python 標準 logging

**理由**:

- 追加依存なし
- ログレベル（DEBUG/INFO/WARNING/ERROR）による出力制御が容易
- コンソール出力とファイル出力をハンドラで切り替えられる
- 各モジュールで `logging.getLogger(__name__)` で名前付きロガーを使用し、出力元を識別できる

**トレードオフ**:

- **利点**: 標準ライブラリ、レベル制御、ファイル/コンソール切り替え
- **欠点**: 初期設定がやや冗長（loguru に比べて）

**ログレベルの使い分け**:

| レベル | 用途 | 例 |
|--------|------|---|
| DEBUG | 開発時の詳細情報 | カルマンフィルタの内部状態、HSV マスクのピクセル数 |
| INFO | 通常の動作記録 | 起動・終了、モデルロード完了、設定値 |
| WARNING | 注意が必要な状況 | 深度欠損が連続、FPS 低下 |
| ERROR | 処理続行不能な問題 | RealSense 未接続、モデルファイル不在 |

### 判断2: 計測結果の記録 — CSV

**問題**: リアルタイム計測した指間距離を記録するか、その形式は何か

**選択肢**:

1. CSV ファイルに記録
2. 記録なし（リアルタイム表示のみ）
3. CSV + グラフ自動生成

**決定**: 選択肢1 — CSV ファイルに記録

**理由**:

- 研究データとして計測結果を後から分析できる
- CSV は Excel、pandas、matplotlib 等あらゆるツールで読める
- フレームごとにタイムスタンプと距離を記録することで、時系列分析が可能
- グラフ生成は後処理スクリプトで行えばよく、リアルタイム処理に含める必要はない

**トレードオフ**:

- **利点**: 汎用的なフォーマット、後から自由に分析可能、ファイル I/O の負荷が小さい
- **欠点**: リアルタイム可視化は別途実装が必要（必要になったら対応）

**CSV フォーマット**:

```csv
timestamp,distance_mm,red_x,red_y,red_z,blue_x,blue_y,blue_z,red_conf,blue_conf
2026-02-26T10:30:00.123,45.2,0.12,0.08,0.45,0.15,0.09,0.46,0.95,0.93
2026-02-26T10:30:00.156,44.8,0.12,0.08,0.45,0.15,0.09,0.46,0.94,0.92
```

| 列 | 説明 |
|----|------|
| timestamp | ISO 8601 形式（ミリ秒精度） |
| distance_mm | フィルタ済み指間距離（mm） |
| red_x/y/z | 赤指サックの 3D 座標（m） |
| blue_x/y/z | 青指サックの 3D 座標（m） |
| red_conf | 赤指サックの YOLO 検出信頼度 |
| blue_conf | 青指サックの YOLO 検出信頼度 |

未検出時は該当列を空にする。

### 判断3: 保存先 — logs/ ディレクトリ

**問題**: ログファイルと計測記録をどこに保存するか

**選択肢**:

1. `logs/` ディレクトリ
2. コンソール出力のみ（ファイル保存なし）

**決定**: 選択肢1 — `logs/` ディレクトリ

**理由**:

- ログと計測記録を一箇所に集約できる
- `.gitignore` で除外し、リポジトリを汚さない
- セッションごとにファイルを分けて管理できる

**トレードオフ**:

- **利点**: 後から参照可能、セッション管理が容易
- **欠点**: ディスク消費（30fps で長時間記録すると大きくなる。CSV 1 行 ~100 バイト × 30fps = ~3KB/秒 = ~11MB/時間）

**ディレクトリ構成**:

```
logs/
  app_2026-02-26_103000.log        # アプリケーションログ
  measurement_2026-02-26_103000.csv # 計測記録
```

- ファイル名にセッション開始時刻を含める
- アプリケーションログと計測記録は別ファイルに分離

## 関連ドキュメント

- [005-realtime-display.md](./005-realtime-display.md) — 表示項目との対応
- [006-config-management.md](./006-config-management.md) — ログレベル等の設定
- [初期仕様書](../../archive/initial_plan.md)
