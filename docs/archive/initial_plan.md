# finger-tracker 初期仕様書

## プロジェクト概要

指サックカラーマーカーによる指間距離リアルタイム計測システム。RealSense D435i の RGB+深度画像から、赤・青の指サックを YOLOv8-nano で検出し、3D空間における指間距離をリアルタイムに計測する。

## 動機

既存研究では、1自由度ロボットハンドによる柔軟物体把持を位置・力ハイブリッド制御で実現している。本プロジェクトはその応用として、人間の指の開閉量をリアルタイムに計測する仕組みを構築する。将来的にはこの計測値をロボットハンドの遠隔操作指令値として使用し、反力を電気刺激で操作者に返すバイラテラルテレオペレーションシステムへの発展を目指す。

## コア機能

1. **データ収集**: RealSense D435i から指サック装着状態の画像を撮影・保存する
2. **モデル学習**: Roboflow でアノテーションした画像データセットで YOLOv8-nano を fine-tuning する
3. **リアルタイム検出**: YOLOv8-nano で `red_finger`（親指）と `blue_finger`（人差指）を検出する
4. **3D距離計測**: 検出した BB 中心の深度値から `rs2_deproject_pixel_to_point` で3D座標に変換し、ユークリッド距離を算出する
5. **ノイズ除去**: 深度値に中央値フィルタを適用し、安定した距離計測を行う

## アーキテクチャ

```
RealSense D435i
    ├── RGB フレーム → YOLOv8-nano → red_finger / blue_finger 検出
    │                                    ↓
    └── 深度フレーム → BB中心ピクセルの深度値取得
                          ↓
              rs2_deproject_pixel_to_point で 3D座標変換
                          ↓
              2点間ユークリッド距離 = 指間距離
                          ↓
              リアルタイム表示（中央値フィルタでノイズ除去）
```

### モジュール構成

| モジュール | 責務 |
|-----------|------|
| capture | RealSense からの画像キャプチャ・データ収集 |
| training | YOLOv8 モデルの学習・評価 |
| detection | 推論 + 深度 → 3D距離計測・リアルタイム表示 |
| config | 設定管理（カメラパラメータ、モデルパス等） |

## 技術要件

### ハードウェア

| 区分 | 機材 | 備考 |
|------|------|------|
| カメラ | Intel RealSense D435i | 既存研究で使用中 |
| マーカー | 赤・青シリコン指サック | 新規購入 |
| PC | Linux PC | 既存研究で使用中 |

### ソフトウェア

| 区分 | 内容 |
|------|------|
| コーディング | VSCode (WSL2) |
| 実行環境 | Linux PC（RealSense接続） |
| 言語 | Python 3.12.3 |
| 主要ライブラリ | pyrealsense2, ultralytics (YOLOv8), OpenCV, NumPy |

### YOLOv8 検出クラス

| クラス名 | 対象 |
|---------|------|
| `red_finger` | 赤指サック（親指） |
| `blue_finger` | 青指サック（人差指） |

### YOLOv8 選定理由

HSV色検出ではなく機械学習ベースの物体検出を採用する理由:
- 背景に赤・青の物体があっても誤検出しない
- 操作者の手の位置（カメラからの距離）を制限しなくて済む
- 「指サックという物体そのもの」を認識するため、色だけに依存しないロバストな検出が可能

### アノテーション手順（Roboflow）

1. RealSenseで指サック装着状態の画像を約300枚撮影
2. Roboflow にアップロード
3. Smart Polygon / Box Prompting で初期ラベル付け（`red_finger`, `blue_finger`）
4. Label Assist で残りを自動ラベル付け
5. YOLOv8形式でエクスポート

## 配布方法

Git + pip 方式。`git clone` 後に `pip install -r requirements.txt` で環境構築。venv を使用。

## ターゲットユーザー

- 本人（研究者）
- 研究室メンバー（将来的にテレオペレーションシステムとして拡張した場合）
